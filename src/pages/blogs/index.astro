---
import Header from '../../components/Header.astro';
import Layout from '../../layouts/Layout.astro';

type Post = {
	title: string;
	slug: string;
	brief: string;
	publishedAt: string;
	coverImage: {
		url: string;
	} | null;
};

type UserData = {
	id: string;
	posts: {
		nodes: Post[];
	};
};

const response = await fetch('https://gql.hashnode.com/', {
	method: 'POST',
	headers: {
		'Content-Type': 'application/json',
	},
	body: JSON.stringify({
		query: `
            query {
                user(username:"akshay2301"){
                    id
                    posts(page:1,pageSize:10){
                        nodes{
                            title
                            slug
                            brief
							publishedAt
                            coverImage {
                                url
                            }
                        }
                    }
                }
            }
        `,
	}),
});

function convertDate(timestamp: string) {
	const date = new Date(timestamp);

	const monthNames = [
		'January',
		'February',
		'March',
		'April',
		'May',
		'June',
		'July',
		'August',
		'September',
		'October',
		'November',
		'December',
	];

	const day = date.getUTCDate();
	const month = monthNames[date.getUTCMonth()];
	const year = date.getUTCFullYear();

	return `${month} ${day} ${year}`;
}

const result = await response.json();

const userData: UserData = result.data.user;
---

<Layout title='Welcome to '>
	<main>
		<div class='headerContainer'>
			<Header title='Read My Blogs' icon='ðŸ”–' />
		</div>
		{
			userData.posts.nodes.map((post: Post) => (
				<div class='post'>
					<a href={'https://akshaygore.hashnode.dev/' + post.slug}>
						<div class='title'>{post.title}</div>
					</a>
					<div class='link'>
						<div>{convertDate(post.publishedAt)}</div>
					</div>
				</div>
			))
		}
	</main>
</Layout>

<style>
	main {
		margin: auto;
		padding: 1rem;
		width: 800px;
		max-width: calc(100% - 2rem);
		color: white;
		font-size: 20px;
		line-height: 1.6;
	}
	.headerContainer {
		padding: 16px 0;
	}
	.navbar {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20px;
		color: aliceblue;
	}

	a {
		color: inherit;
		text-decoration: none;
		font-size: 20px;
		line-height: 1.6;
	}
	.title {
		font-size: 16px;
	}
	h2 {
		font-size: 24px;
	}
	.post {
		padding: 12px 0;
	}
	.link {
		font-size: 12px;
		color: rgb(163 163 163);
	}
	a {
		color: inherit;
		font-size: 14px;
	}
</style>
